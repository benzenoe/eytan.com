# Eytan.com Frontend - Quick Reference

**Last Updated:** December 11, 2025 (Session 8 - Password Protection)

## This Repository

**Frontend for eytan.com** - Static site hosted on GitHub Pages

- **URL:** https://eytan.com
- **GitHub:** https://github.com/benzenoe/eytan.com.git
- **Hosting:** GitHub Pages (deploys automatically from main branch)
- **Deployment time:** 1-2 minutes after push

## Related Repositories

- **Backend API:** `C:\Users\eytan_s9t3al\Documents\test-claude\blog-backend`
  - GitHub: https://github.com/benzenoe/eytan-com-blog-backend.git
  - Hosted on: Railway (https://api.eytan.com)

## How It Works

1. **Blog listing** (`blog.html`) → Fetches posts from API: `https://api.eytan.com/api/posts?status=published`
2. **Individual posts** (`blog-post.html`) → Fetches from API + loads markdown from `posts/{post-id}.md`
3. **Admin panel** (`admin.html`) → Manages posts via API

## Key Files

- `blog.html` - Blog listing page
- `blog-post.html` - Individual post page
- `admin.html` - Admin panel
- `js/blog.js` - Blog listing logic
- `js/blog-post.js` - Post display logic
- `js/admin.js` - Admin panel logic (updated with image upload API - lines 369-427)
- `data/blog-posts.json` - Post metadata (auto-generated by backend)
- `posts/{post-id}.md` - Post content (auto-generated by backend)
- `images/blog/` - Uploaded blog images (NEW - Dec 7, 2025)

## Image Upload System (NEW - Dec 7, 2025)

**How it works:**
- Admin uploads image in `admin.html` → JavaScript calls `POST https://api.eytan.com/api/upload/image`
- Backend uploads to `images/blog/{timestamp}-{filename}` in this repo
- Returns URL like `/images/blog/1733550123-photo.jpg`
- Database stores URL (NOT base64!)
- Images served from GitHub Pages (fast, cached)

**Benefits:**
- ✅ No database corruption
- ✅ 2MB max enforced by API
- ✅ Fast loading via CDN

**Code:** `js/admin.js` lines 369-427

---

## Common Fixes

### Posts not showing after publish
```bash
# User needs to hard refresh browser:
Ctrl + Shift + R (Windows)
Cmd + Shift + R (Mac)

# Wait 1-2 minutes for GitHub Pages to deploy
```

### Edit buttons grayed out
Check `js/admin.js` line 69 - should NOT have `disabled` attribute:
```javascript
<button class="btn-icon btn-edit" onclick="editPost('${post.id}')" title="Edit">
```

### Deployment
```bash
git add .
git commit -m "Description"
git push
# GitHub Pages auto-deploys in 1-2 minutes
```

## Session History

### Session 3 (Dec 8, 2025)
**Issue:** Post "test4" showing "Post Not Found" on live site

**Root cause:** Inconsistent markdown file directories
- System had both `posts/` and `blog/` directories
- Frontend loaded from `blog/` which had incorrect content
- Backend republish script used `posts/` which had correct content

**Fix implemented:**
- ✅ Updated `js/blog-post.js` to load from `posts/` directory (line 87)
- ✅ Removed deprecated `blog/` directory
- ✅ Backend now publishes to `posts/` directory only
- ✅ System now standardized on single directory structure

**Files modified:**
- `js/blog-post.js` - Changed fetch path from blog/ to posts/
- `blog/` directory - Removed (deprecated)

---

### Session 8 (Dec 11, 2025)
**Issue:** Admin panel had no password protection - anyone could access and modify posts

**Implementation:**
- ✅ Created `login.html` with modern design and rate limiting (10 attempts per 15 minutes)
- ✅ Added authentication checks to `admin.html` and `admin-editor.html`
- ✅ Added logout button to admin panel
- ✅ Implemented localStorage-based authentication (7-day session)

**Problem Encountered:**
Cross-domain cookie issues between `eytan.com` and `api.eytan.com`:
- Session cookies wouldn't persist across subdomains
- Browser security policies rejected cross-domain cookies
- Login succeeded but immediately redirected back to login page

**Solution:**
- Used localStorage instead of cookies for authentication state
- Stores `adminAuth=true` and `adminAuthTime=timestamp` in browser
- 7-day session expiration
- Graceful fallback to backend session if localStorage unavailable

**Known Issue:**
- Posts not loading in admin panel after authentication fix (debugging in progress)
- API endpoint works correctly (returns 5 posts)
- Issue is in frontend JavaScript - added debugging logs to investigate

**Files Created:**
- `login.html` - Login page with password authentication

**Files Modified:**
- `admin.html` - Authentication check, logout button, localStorage support, debugging
- `admin-editor.html` - Authentication check, localStorage support
- `js/admin.js` - Logout function, localStorage support, fixed duplicate API_URL declaration

**Commits:**
- "Add password protection to admin pages" (0d60449)
- "Add debugging logs for authentication issue" (cbc7621)
- "Fix authentication with localStorage fallback" (11da6ea)
- "Fix duplicate API_URL declaration" (5c17f93)
- "Add extensive debugging for post loading issue" (1dacd83)

---

## For Full Documentation

See the backend repo for complete documentation:
`C:\Users\eytan_s9t3al\Documents\test-claude\blog-backend\CLAUDE-MEMORY.md`
